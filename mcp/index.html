<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/muxi/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/muxi/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(6)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(6) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(6) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(6) > ul.nav-list { display: block; } </style> <script src="/muxi/assets/js/vendor/lunr.min.js"></script> <script src="/muxi/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>MCPs | MUXI Framework</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="MCPs" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="An extensible framework for building AI agents with real-time communication capabilities, memory persistence, and tool integration" /> <meta property="og:description" content="An extensible framework for building AI agents with real-time communication capabilities, memory persistence, and tool integration" /> <link rel="canonical" href="https://ranaroussi.github.io/muxi/muxi/mcp/" /> <meta property="og:url" content="https://ranaroussi.github.io/muxi/muxi/mcp/" /> <meta property="og:site_name" content="MUXI Framework" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="MCPs" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"An extensible framework for building AI agents with real-time communication capabilities, memory persistence, and tool integration","headline":"MCPs","url":"https://ranaroussi.github.io/muxi/muxi/mcp/"}</script> <!-- End Jekyll SEO tag --> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script> <script>window.addEventListener("load", function() { mermaid.initialize({ startOnLoad: true }); });</script> <style> .mermaid { text-align: center; margin: 2rem auto; max-width: 100%; padding: 1rem; } body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; } .site-logo { width: 40px; height: 40px; padding-right: 10px; } .site-header { display: flex; align-items: center; height: 60px; } .site-header .site-title { display: flex; align-items: center; font-weight: 700; } .site-header .site-title:hover { background-image: none; } </style> <!-- Favicon links --> <link rel="apple-touch-icon" sizes="180x180" href="/muxi/assets/images/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/muxi/assets/images/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/muxi/assets/images/favicon-16x16.png"> <link rel="manifest" href="/muxi/assets/images/site.webmanifest"> <link rel="shortcut icon" href="/muxi/assets/images/favicon.ico"> <title>MCPs | MUXI AI Agent Framework</title> <meta name="description" content="An extensible framework for building AI agents with real-time communication capabilities, memory persistence, and tool integration"/> <meta property="og:title" content="MCPs | MUXI AI Agent Framework"/> <meta property="og:locale" content="en_US"/> <meta property="og:description" content="An extensible framework for building AI agents with real-time communication capabilities, memory persistence, and tool integration"/> <meta property="og:url" content="https://ranaroussi.github.io/muxi/muxi/mcp/"/> <meta property="og:site_name" content="MUXI AI Agent Framework"/> <meta property="og:type" content="website"/> <meta property="og:image" content="https://opengraph.githubassets.com/1/ranaroussi/muxi" /> <meta name="twitter:card" content="summary"/> <meta name="twitter:creator" content="@aroussi"/> <meta name="twitter:title" content="MCPs | MUXI AI Agent Framework"/> <meta name="twitter:description" content="An extensible framework for building AI agents with real-time communication capabilities, memory persistence, and tool integration"/> <meta name="twitter:image" content="https://opengraph.githubassets.com/1/ranaroussi/muxi" /> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/muxi/" class="site-title lh-tight"> MUXI Framework </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/muxi/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/muxi/getting-started/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/muxi/overview/" class="nav-list-link">Introduction</a></li><li class="nav-list-item"><a href="/muxi/quickstart/" class="nav-list-link">Quickstart Guide</a></li><li class="nav-list-item"><a href="/muxi/architecture/" class="nav-list-link">Architecture</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/muxi/core-concepts/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/muxi/agents/" class="nav-list-link">Agents</a></li><li class="nav-list-item"><a href="/muxi/orchestrator/" class="nav-list-link">Orchestrator</a></li><li class="nav-list-item"><a href="/muxi/memory/" class="nav-list-link">Memory</a></li><li class="nav-list-item"><a href="/muxi/tools/" class="nav-list-link">Tools</a></li><li class="nav-list-item"><a href="/muxi/models/" class="nav-list-link">LLM Models</a></li><li class="nav-list-item"><a href="/muxi/mcp/" class="nav-list-link">MCPs</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in User Interfaces category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/muxi/user-interfaces/" class="nav-list-link">User Interfaces</a><ul class="nav-list"><li class="nav-list-item"><a href="/muxi/cli/" class="nav-list-link">CLI</a></li><li class="nav-list-item"><a href="/muxi/webapp/" class="nav-list-link">Webapp</a></li><li class="nav-list-item"><a href="/muxi/api/" class="nav-list-link">API</a></li><li class="nav-list-item"><a href="/muxi/websocket/" class="nav-list-link">WebSocket</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Resources category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/muxi/resources/" class="nav-list-link">Resources</a><ul class="nav-list"><li class="nav-list-item"><a href="/muxi/agents-vs-tools/" class="nav-list-link">Agents vs Tools</a></li><li class="nav-list-item"><a href="/muxi/tools-vs-mcp/" class="nav-list-link">Tools vs MCP</a></li><li class="nav-list-item"><a href="/muxi/roadmap/" class="nav-list-link">Development Roadmap</a></li><li class="nav-list-item"><a href="/muxi/toc/" class="nav-list-link">Documentation Progress</a></li><li class="nav-list-item"><a href="/muxi/contributing/" class="nav-list-link">Contributing to MUXI</a></li></ul></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/ranaroussi/muxi" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > MUXI on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search MUXI Framework" aria-label="Search MUXI Framework" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/ranaroussi/muxi" class="site-button" target="_blank" rel="noopener noreferrer" > MUXI on GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/muxi/core-concepts/">Core Concepts</a></li> <li class="breadcrumb-nav-list-item"><span>MCPs</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="model-context-protocol-mcp"> <a href="#model-context-protocol-mcp" class="anchor-heading" aria-labelledby="model-context-protocol-mcp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Model Context Protocol (MCP) </h1> <p>The Model Context Protocol (MCP) is a standardized format for communication between applications and Large Language Models. It provides a structured way to send prompts, receive responses, and process tool calls.</p> <h2 id="what-is-mcp"> <a href="#what-is-mcp" class="anchor-heading" aria-labelledby="what-is-mcp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is MCP? </h2> <p>MCP is a protocol that:</p> <ul> <li>Standardizes the format of messages sent to and received from language models</li> <li>Enables structured tool calling by language models</li> <li>Provides a consistent interface across different language model providers</li> <li>Improves the control and predictability of language model interactions</li> <li>Facilitates advanced features like parallel tool execution and multi-step reasoning</li> </ul> <h2 id="mcp-vs-tools-understanding-the-distinction"> <a href="#mcp-vs-tools-understanding-the-distinction" class="anchor-heading" aria-labelledby="mcp-vs-tools-understanding-the-distinction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MCP vs Tools: Understanding the Distinction </h2> <p>One common source of confusion is the relationship between MCP and tools. Let’s clarify this important distinction:</p> <h3 id="mcp-is-a-communication-protocol-not-the-tools"> <a href="#mcp-is-a-communication-protocol-not-the-tools" class="anchor-heading" aria-labelledby="mcp-is-a-communication-protocol-not-the-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MCP is a Communication Protocol, Not the Tools </h3> <ul> <li> <p><strong>MCP (Model Context Protocol)</strong>: A standardized message format and communication protocol for interacting with language models. It’s the “language” your application uses to talk to models like GPT-4 or Claude.</p> </li> <li> <p><strong>Tools</strong>: Specific capabilities that extend what your agent can do (like web search, calculations, database queries, etc.). Each tool has its own functionality that executes in your application environment.</p> </li> </ul> <h3 id="tool-execution-flow"> <a href="#tool-execution-flow" class="anchor-heading" aria-labelledby="tool-execution-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Execution Flow </h3> <p>The complete flow of tool usage looks like this:</p> <ol> <li>User sends a query to your agent</li> <li>The agent passes this query to the language model via the MCP Handler</li> <li>The language model determines a tool is needed and responds with a tool call request (in MCP format)</li> <li>The MCP Handler parses this response and recognizes the tool call</li> <li><strong>The framework (not the language model, not the MCP) passes the request to the appropriate tool</strong></li> <li><strong>The tool executes in your application environment with access to your system resources</strong></li> <li>The tool returns results to your framework</li> <li>Results are formatted as an MCP message and sent back to the language model</li> <li>The language model incorporates these results into its final response</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌───────────┐    Query     ┌──────────────┐     MCP format     ┌─────┐
│   User    ├─────────────►│ Agent/       ├───────────────────►│     │
└───────────┘              │ Orchestrator │                    │     │
                           └──────┬───────┘                    │     │
                                  │                            │     │
                                  │                            │ LLM │
                        ┌─────────▼────────┐                  │     │
┌─────────────┐         │                  │   Tool request   │     │
│ Application │         │   MCP Handler    │◄─────────────────┤     │
│ Environment │         │                  │                  └─────┘
│             │         └─────────┬────────┘
│    ┌────────▼─────┐             │
│    │              │    Tool     │
│    │     Tool     │◄────request─┘
│    │   Execution  │
│    │              │
│    └──────┬───────┘
│           │
│    Tool   │
│    result │
│           │
└───────────▼───────┐
               MCP  │
              format│
                    ▼
                 Results
                 to LLM
</code></pre></div></div> <h3 id="key-points-to-remember"> <a href="#key-points-to-remember" class="anchor-heading" aria-labelledby="key-points-to-remember"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Points to Remember </h3> <ul> <li><strong>MCP is the messenger</strong>: It formats messages between your application and the language model</li> <li><strong>Language model makes the decision</strong>: The language model (not your code) decides when a tool is needed</li> <li><strong>Your framework executes tools</strong>: Tools run in your application’s environment, not inside the language model</li> <li><strong>MCP formats tool results</strong>: The results are sent back to the language model through the MCP format</li> </ul> <p>This clarifies that MCP is not the tools themselves—it’s just the standardized way to communicate about tools with the language model.</p> <h2 id="mcp-message-structure"> <a href="#mcp-message-structure" class="anchor-heading" aria-labelledby="mcp-message-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MCP Message Structure </h2> <p>The core of MCP is the message structure:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MCPMessage</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tool_calls</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tool_call_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role</span>  <span class="c1"># "user", "assistant", "system", or "tool"
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>  <span class="c1"># Text content of the message
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">tool_calls</span> <span class="o">=</span> <span class="n">tool_calls</span> <span class="ow">or</span> <span class="p">[]</span>  <span class="c1"># List of tool calls made by the assistant
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">tool_call_id</span> <span class="o">=</span> <span class="n">tool_call_id</span>  <span class="c1"># ID of the tool call this message responds to
</span></code></pre></div></div> <h3 id="message-roles"> <a href="#message-roles" class="anchor-heading" aria-labelledby="message-roles"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Message Roles </h3> <p>MCP supports several message roles:</p> <ul> <li><strong>user</strong>: Messages from the user to the language model</li> <li><strong>assistant</strong>: Responses from the language model</li> <li><strong>system</strong>: System instructions that guide the language model’s behavior</li> <li><strong>tool</strong>: Results returned from tool executions</li> </ul> <h3 id="tool-calls"> <a href="#tool-calls" class="anchor-heading" aria-labelledby="tool-calls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Calls </h3> <p>Tool calls are structured as:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MCPToolCall</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">tool_id</span><span class="p">,</span> <span class="n">tool_args</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tool_name</span> <span class="o">=</span> <span class="n">tool_name</span>  <span class="c1"># Name of the tool to call
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">tool_id</span> <span class="o">=</span> <span class="n">tool_id</span>  <span class="c1"># Unique identifier for this tool call
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">tool_args</span> <span class="o">=</span> <span class="n">tool_args</span>  <span class="c1"># Arguments for the tool, as a dictionary
</span></code></pre></div></div> <h2 id="using-mcp-in-the-framework"> <a href="#using-mcp-in-the-framework" class="anchor-heading" aria-labelledby="using-mcp-in-the-framework"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using MCP in the Framework </h2> <h3 id="basic-message-exchange"> <a href="#basic-message-exchange" class="anchor-heading" aria-labelledby="basic-message-exchange"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Message Exchange </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.mcp.message</span> <span class="kn">import</span> <span class="n">MCPMessage</span>
<span class="kn">from</span> <span class="nn">src.models.openai</span> <span class="kn">import</span> <span class="n">OpenAIModel</span>

<span class="c1"># Create messages
</span><span class="n">system_message</span> <span class="o">=</span> <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"You are a helpful assistant."</span><span class="p">)</span>
<span class="n">user_message</span> <span class="o">=</span> <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"What's the weather in London?"</span><span class="p">)</span>

<span class="c1"># Prepare messages for language model
</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">system_message</span><span class="p">,</span> <span class="n">user_message</span><span class="p">]</span>

<span class="c1"># Send to language model
</span><span class="n">model</span> <span class="o">=</span> <span class="n">OpenAIModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"gpt-4o"</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

<span class="c1"># Process response
</span><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">MCPMessage</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Assistant: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="c1"># Handle any tool calls
</span>    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tool_call</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Tool Call: </span><span class="si">{</span><span class="n">tool_call</span><span class="p">.</span><span class="n">tool_name</span><span class="si">}</span><span class="s"> with args </span><span class="si">{</span><span class="n">tool_call</span><span class="p">.</span><span class="n">tool_args</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div> <h3 id="tool-calling-flow"> <a href="#tool-calling-flow" class="anchor-heading" aria-labelledby="tool-calling-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Calling Flow </h3> <p>The complete flow of a tool-enabled conversation:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.mcp.message</span> <span class="kn">import</span> <span class="n">MCPMessage</span><span class="p">,</span> <span class="n">MCPToolCall</span>
<span class="kn">from</span> <span class="nn">src.models.openai</span> <span class="kn">import</span> <span class="n">OpenAIModel</span>
<span class="kn">from</span> <span class="nn">src.tools.registry</span> <span class="kn">import</span> <span class="n">ToolRegistry</span>
<span class="kn">from</span> <span class="nn">src.tools.weather</span> <span class="kn">import</span> <span class="n">WeatherTool</span>

<span class="c1"># Set up language model and tools
</span><span class="n">model</span> <span class="o">=</span> <span class="n">OpenAIModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"gpt-4o"</span><span class="p">)</span>
<span class="n">registry</span> <span class="o">=</span> <span class="n">ToolRegistry</span><span class="p">()</span>
<span class="n">registry</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">WeatherTool</span><span class="p">())</span>

<span class="c1"># Create initial messages
</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"You are a helpful assistant with access to tools."</span><span class="p">),</span>
    <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"What's the weather in London?"</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Send to language model
</span><span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
<span class="n">messages</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># Process tool calls
</span><span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">tool_call</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">:</span>
        <span class="c1"># Get the tool
</span>        <span class="n">tool</span> <span class="o">=</span> <span class="n">registry</span><span class="p">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">.</span><span class="n">tool_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tool</span><span class="p">:</span>
            <span class="c1"># Execute the tool
</span>            <span class="n">tool_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="o">**</span><span class="n">tool_call</span><span class="p">.</span><span class="n">tool_args</span><span class="p">)</span>

            <span class="c1"># Create tool response message
</span>            <span class="n">tool_message</span> <span class="o">=</span> <span class="n">MCPMessage</span><span class="p">(</span>
                <span class="n">role</span><span class="o">=</span><span class="s">"tool"</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">tool_result</span><span class="p">),</span>
                <span class="n">tool_call_id</span><span class="o">=</span><span class="n">tool_call</span><span class="p">.</span><span class="n">tool_id</span>
            <span class="p">)</span>

            <span class="c1"># Add tool response to messages
</span>            <span class="n">messages</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_message</span><span class="p">)</span>

    <span class="c1"># Get final response from language model
</span>    <span class="n">final_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
    <span class="n">messages</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_response</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Assistant: </span><span class="si">{</span><span class="n">final_response</span><span class="p">.</span><span class="n">content</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div> <h2 id="mcp-handler"> <a href="#mcp-handler" class="anchor-heading" aria-labelledby="mcp-handler"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MCP Handler </h2> <p>The framework provides an MCP handler to abstract the message processing:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.mcp.handler</span> <span class="kn">import</span> <span class="n">MCPHandler</span>
<span class="kn">from</span> <span class="nn">src.models.openai</span> <span class="kn">import</span> <span class="n">OpenAIModel</span>
<span class="kn">from</span> <span class="nn">src.tools.registry</span> <span class="kn">import</span> <span class="n">ToolRegistry</span>
<span class="kn">from</span> <span class="nn">src.tools.weather</span> <span class="kn">import</span> <span class="n">WeatherTool</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">chat_with_tools</span><span class="p">():</span>
    <span class="c1"># Set up language model, tools, and handler
</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">OpenAIModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"gpt-4o"</span><span class="p">)</span>

    <span class="n">registry</span> <span class="o">=</span> <span class="n">ToolRegistry</span><span class="p">()</span>
    <span class="n">registry</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">WeatherTool</span><span class="p">())</span>

    <span class="n">handler</span> <span class="o">=</span> <span class="n">MCPHandler</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">tool_registry</span><span class="o">=</span><span class="n">registry</span><span class="p">)</span>

    <span class="c1"># Set system message
</span>    <span class="n">handler</span><span class="p">.</span><span class="n">set_system_message</span><span class="p">(</span><span class="s">"You are a helpful assistant with access to tools."</span><span class="p">)</span>

    <span class="c1"># Process a user message
</span>    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">.</span><span class="n">process_message</span><span class="p">(</span><span class="s">"What's the weather in London?"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Assistant: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="c1"># Continue the conversation
</span>    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">.</span><span class="n">process_message</span><span class="p">(</span><span class="s">"How about Paris?"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Assistant: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="c1"># Run the chat
</span><span class="k">await</span> <span class="n">chat_with_tools</span><span class="p">()</span>
</code></pre></div></div> <h2 id="mcp-with-different-language-model-providers"> <a href="#mcp-with-different-language-model-providers" class="anchor-heading" aria-labelledby="mcp-with-different-language-model-providers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MCP with Different Language Model Providers </h2> <p>The MCP standardizes interactions across different language model providers:</p> <h3 id="openai-implementation"> <a href="#openai-implementation" class="anchor-heading" aria-labelledby="openai-implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> OpenAI Implementation </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.mcp.message</span> <span class="kn">import</span> <span class="n">MCPMessage</span>
<span class="kn">from</span> <span class="nn">src.models.openai</span> <span class="kn">import</span> <span class="n">OpenAIModel</span>

<span class="c1"># Create an OpenAI language model
</span><span class="n">model</span> <span class="o">=</span> <span class="n">OpenAIModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"gpt-4o"</span><span class="p">)</span>

<span class="c1"># Process MCP messages
</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"You are a helpful assistant."</span><span class="p">),</span>
    <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"Who won the 2022 World Cup?"</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div> <h3 id="anthropic-implementation"> <a href="#anthropic-implementation" class="anchor-heading" aria-labelledby="anthropic-implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Anthropic Implementation </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.mcp.message</span> <span class="kn">import</span> <span class="n">MCPMessage</span>
<span class="kn">from</span> <span class="nn">src.models.anthropic</span> <span class="kn">import</span> <span class="n">AnthropicModel</span>

<span class="c1"># Create an Anthropic language model
</span><span class="n">model</span> <span class="o">=</span> <span class="n">AnthropicModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"claude-3-opus"</span><span class="p">)</span>

<span class="c1"># Process MCP messages (same format as OpenAI)
</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"You are a helpful assistant."</span><span class="p">),</span>
    <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"Who won the 2022 World Cup?"</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div> <h2 id="advanced-mcp-features"> <a href="#advanced-mcp-features" class="anchor-heading" aria-labelledby="advanced-mcp-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced MCP Features </h2> <h3 id="parallel-tool-execution"> <a href="#parallel-tool-execution" class="anchor-heading" aria-labelledby="parallel-tool-execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Parallel Tool Execution </h3> <p>MCP allows for parallel execution of multiple tool calls:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.mcp.handler</span> <span class="kn">import</span> <span class="n">MCPHandler</span><span class="p">,</span> <span class="n">execute_tool_calls_parallel</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">process_with_parallel_tools</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">user_message</span><span class="p">):</span>
    <span class="c1"># Get response from language model
</span>    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span>
        <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">handler</span><span class="p">.</span><span class="n">system_message</span><span class="p">),</span>
        <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">user_message</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">:</span>
        <span class="c1"># Execute all tool calls in parallel
</span>        <span class="n">tool_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool_calls_parallel</span><span class="p">(</span>
            <span class="n">response</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">,</span>
            <span class="n">handler</span><span class="p">.</span><span class="n">tool_registry</span>
        <span class="p">)</span>

        <span class="c1"># Add all tool results to the conversation
</span>        <span class="n">tool_messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tool_call_id</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tool_results</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tool_messages</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">MCPMessage</span><span class="p">(</span>
                <span class="n">role</span><span class="o">=</span><span class="s">"tool"</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
                <span class="n">tool_call_id</span><span class="o">=</span><span class="n">tool_call_id</span>
            <span class="p">))</span>

        <span class="c1"># Get final response with tool results
</span>        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">handler</span><span class="p">.</span><span class="n">system_message</span><span class="p">),</span>
            <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">user_message</span><span class="p">),</span>
            <span class="n">response</span><span class="p">,</span>  <span class="c1"># The assistant's response with tool calls
</span>            <span class="o">*</span><span class="n">tool_messages</span>  <span class="c1"># All tool results
</span>        <span class="p">]</span>

        <span class="n">final_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_response</span><span class="p">.</span><span class="n">content</span>

    <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span>
</code></pre></div></div> <h3 id="multi-model-chain"> <a href="#multi-model-chain" class="anchor-heading" aria-labelledby="multi-model-chain"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-Model Chain </h3> <p>You can chain different language models together using MCP as a common interface:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.mcp.message</span> <span class="kn">import</span> <span class="n">MCPMessage</span>
<span class="kn">from</span> <span class="nn">src.models.openai</span> <span class="kn">import</span> <span class="n">OpenAIModel</span>
<span class="kn">from</span> <span class="nn">src.models.anthropic</span> <span class="kn">import</span> <span class="n">AnthropicModel</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">multi_model_processing</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="c1"># First model generates a detailed plan
</span>    <span class="n">planning_model</span> <span class="o">=</span> <span class="n">OpenAIModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"gpt-4o"</span><span class="p">)</span>
    <span class="n">plan_messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"You are a planning assistant. Create a detailed plan."</span><span class="p">),</span>
        <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s">"Create a research plan for: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">plan_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">planning_model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">plan_messages</span><span class="p">)</span>

    <span class="c1"># Second model executes the plan
</span>    <span class="n">execution_model</span> <span class="o">=</span> <span class="n">AnthropicModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"claude-3-opus"</span><span class="p">)</span>
    <span class="n">execution_messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"You are a research assistant. Execute the given plan."</span><span class="p">),</span>
        <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s">"Execute this research plan:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">plan_response</span><span class="p">.</span><span class="n">content</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">execution_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execution_model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">execution_messages</span><span class="p">)</span>

    <span class="c1"># Third model summarizes the results
</span>    <span class="n">summary_model</span> <span class="o">=</span> <span class="n">OpenAIModel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"gpt-3.5-turbo"</span><span class="p">)</span>
    <span class="n">summary_messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"system"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"You are a summarization assistant. Create concise summaries."</span><span class="p">),</span>
        <span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s">"Summarize these research results:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">execution_response</span><span class="p">.</span><span class="n">content</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">summary_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">summary_model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">summary_messages</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s">"plan"</span><span class="p">:</span> <span class="n">plan_response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span>
        <span class="s">"execution"</span><span class="p">:</span> <span class="n">execution_response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span>
        <span class="s">"summary"</span><span class="p">:</span> <span class="n">summary_response</span><span class="p">.</span><span class="n">content</span>
    <span class="p">}</span>
</code></pre></div></div> <h2 id="custom-mcp-extensions"> <a href="#custom-mcp-extensions" class="anchor-heading" aria-labelledby="custom-mcp-extensions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom MCP Extensions </h2> <p>You can extend the MCP format for custom needs:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.mcp.message</span> <span class="kn">import</span> <span class="n">MCPMessage</span>

<span class="k">class</span> <span class="nc">ExtendedMCPMessage</span><span class="p">(</span><span class="n">MCPMessage</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tool_calls</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tool_call_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">tool_calls</span><span class="p">,</span> <span class="n">tool_call_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>  <span class="c1"># Additional metadata for the message
</span>
<span class="c1"># Example usage
</span><span class="n">message</span> <span class="o">=</span> <span class="n">ExtendedMCPMessage</span><span class="p">(</span>
    <span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span><span class="s">"What's the weather in London?"</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
        <span class="s">"timestamp"</span><span class="p">:</span> <span class="s">"2023-06-15T14:30:00Z"</span><span class="p">,</span>
        <span class="s">"user_id"</span><span class="p">:</span> <span class="s">"user_123"</span><span class="p">,</span>
        <span class="s">"session_id"</span><span class="p">:</span> <span class="s">"session_456"</span><span class="p">,</span>
        <span class="s">"client_info"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"device"</span><span class="p">:</span> <span class="s">"mobile"</span><span class="p">,</span>
            <span class="s">"browser"</span><span class="p">:</span> <span class="s">"chrome"</span><span class="p">,</span>
            <span class="s">"language"</span><span class="p">:</span> <span class="s">"en-US"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div> <h2 id="mcp-message-serialization"> <a href="#mcp-message-serialization" class="anchor-heading" aria-labelledby="mcp-message-serialization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MCP Message Serialization </h2> <p>For storing or transmitting MCP messages, you can serialize them:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">src.mcp.message</span> <span class="kn">import</span> <span class="n">MCPMessage</span><span class="p">,</span> <span class="n">MCPToolCall</span>

<span class="k">def</span> <span class="nf">serialize_mcp_message</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="s">"""Serialize an MCP message to a dictionary."""</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"role"</span><span class="p">:</span> <span class="n">message</span><span class="p">.</span><span class="n">role</span><span class="p">,</span>
        <span class="s">"content"</span><span class="p">:</span> <span class="n">message</span><span class="p">.</span><span class="n">content</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">message</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">"tool_calls"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"tool_name"</span><span class="p">:</span> <span class="n">tc</span><span class="p">.</span><span class="n">tool_name</span><span class="p">,</span>
                <span class="s">"tool_id"</span><span class="p">:</span> <span class="n">tc</span><span class="p">.</span><span class="n">tool_id</span><span class="p">,</span>
                <span class="s">"tool_args"</span><span class="p">:</span> <span class="n">tc</span><span class="p">.</span><span class="n">tool_args</span>
            <span class="p">}</span> <span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="n">message</span><span class="p">.</span><span class="n">tool_calls</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="n">message</span><span class="p">.</span><span class="n">tool_call_id</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">"tool_call_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="n">tool_call_id</span>

    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">deserialize_mcp_message</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="s">"""Deserialize a dictionary to an MCP message."""</span>
    <span class="n">tool_calls</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="s">"tool_calls"</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">tool_calls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">MCPToolCall</span><span class="p">(</span>
                <span class="n">tool_name</span><span class="o">=</span><span class="n">tc</span><span class="p">[</span><span class="s">"tool_name"</span><span class="p">],</span>
                <span class="n">tool_id</span><span class="o">=</span><span class="n">tc</span><span class="p">[</span><span class="s">"tool_id"</span><span class="p">],</span>
                <span class="n">tool_args</span><span class="o">=</span><span class="n">tc</span><span class="p">[</span><span class="s">"tool_args"</span><span class="p">]</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">"tool_calls"</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="k">return</span> <span class="n">MCPMessage</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">"role"</span><span class="p">],</span>
        <span class="n">content</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"content"</span><span class="p">),</span>
        <span class="n">tool_calls</span><span class="o">=</span><span class="n">tool_calls</span><span class="p">,</span>
        <span class="n">tool_call_id</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"tool_call_id"</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Example usage
</span><span class="n">message</span> <span class="o">=</span> <span class="n">MCPMessage</span><span class="p">(</span>
    <span class="n">role</span><span class="o">=</span><span class="s">"assistant"</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span><span class="s">"I'll check the weather for you."</span><span class="p">,</span>
    <span class="n">tool_calls</span><span class="o">=</span><span class="p">[</span>
        <span class="n">MCPToolCall</span><span class="p">(</span>
            <span class="n">tool_name</span><span class="o">=</span><span class="s">"weather"</span><span class="p">,</span>
            <span class="n">tool_id</span><span class="o">=</span><span class="s">"call_123"</span><span class="p">,</span>
            <span class="n">tool_args</span><span class="o">=</span><span class="p">{</span><span class="s">"location"</span><span class="p">:</span> <span class="s">"London"</span><span class="p">}</span>
        <span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Serialize to JSON
</span><span class="n">serialized</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">serialize_mcp_message</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

<span class="c1"># Deserialize from JSON
</span><span class="n">deserialized_data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serialized</span><span class="p">)</span>
<span class="n">restored_message</span> <span class="o">=</span> <span class="n">deserialize_mcp_message</span><span class="p">(</span><span class="n">deserialized_data</span><span class="p">)</span>
</code></pre></div></div> <h2 id="websocket-integration"> <a href="#websocket-integration" class="anchor-heading" aria-labelledby="websocket-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Websocket Integration </h2> <p>MCP messages can be transmitted via WebSockets for real-time communication:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Server-side
</span><span class="kn">from</span> <span class="nn">src.mcp.handler</span> <span class="kn">import</span> <span class="n">MCPHandler</span>
<span class="kn">from</span> <span class="nn">src.mcp.message</span> <span class="kn">import</span> <span class="n">MCPMessage</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_websocket</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="c1"># Set up MCP handler
</span>    <span class="n">handler</span> <span class="o">=</span> <span class="n">MCPHandler</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">tool_registry</span><span class="o">=</span><span class="n">registry</span><span class="p">)</span>
    <span class="n">handler</span><span class="p">.</span><span class="n">set_system_message</span><span class="p">(</span><span class="s">"You are a helpful assistant."</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">websocket</span><span class="p">:</span>
        <span class="c1"># Parse incoming message
</span>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"chat"</span><span class="p">:</span>
            <span class="c1"># Process the user message through MCP
</span>            <span class="n">user_message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"message"</span><span class="p">]</span>

            <span class="c1"># Add to conversation history
</span>            <span class="n">handler</span><span class="p">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">MCPMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">user_message</span><span class="p">))</span>

            <span class="c1"># Process the message and get response
</span>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">.</span><span class="n">process_current_messages</span><span class="p">()</span>

            <span class="c1"># Send response back
</span>            <span class="k">await</span> <span class="n">websocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">({</span>
                <span class="s">"type"</span><span class="p">:</span> <span class="s">"response"</span><span class="p">,</span>
                <span class="s">"message"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span>
                <span class="s">"has_tool_calls"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">)</span>
            <span class="p">}))</span>

            <span class="c1"># If there are tool calls, send their results
</span>            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">tool_calls</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tool_result</span> <span class="ow">in</span> <span class="n">handler</span><span class="p">.</span><span class="n">last_tool_results</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">websocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">({</span>
                        <span class="s">"type"</span><span class="p">:</span> <span class="s">"tool_result"</span><span class="p">,</span>
                        <span class="s">"tool_name"</span><span class="p">:</span> <span class="n">tool_result</span><span class="p">[</span><span class="s">"tool_name"</span><span class="p">],</span>
                        <span class="s">"result"</span><span class="p">:</span> <span class="n">tool_result</span><span class="p">[</span><span class="s">"result"</span><span class="p">]</span>
                    <span class="p">}))</span>
</code></pre></div></div> <h2 id="best-practices"> <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices </h2> <ol> <li> <p><strong>Consistent Message Format</strong>: Always use the MCPMessage class for consistency</p> </li> <li> <p><strong>Tool Result Handling</strong>: Properly format tool results as MCPMessages with the “tool” role</p> </li> <li> <p><strong>System Messages</strong>: Use descriptive system messages to guide language model behavior</p> </li> <li> <p><strong>Error Handling</strong>: Implement robust error handling for tool calls</p> </li> <li> <p><strong>Message History Management</strong>: Keep message history manageable to avoid token limits</p> </li> <li> <p><strong>Validation</strong>: Validate incoming messages to ensure they conform to MCP structure</p> </li> </ol> <h2 id="troubleshooting"> <a href="#troubleshooting" class="anchor-heading" aria-labelledby="troubleshooting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Troubleshooting </h2> <h3 id="tool-call-format-issues"> <a href="#tool-call-format-issues" class="anchor-heading" aria-labelledby="tool-call-format-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Call Format Issues </h3> <ul> <li>Ensure tool calls are correctly formatted with proper tool names and arguments</li> <li>Check that the tool implementation matches the expected parameter structure</li> </ul> <h3 id="message-handling-errors"> <a href="#message-handling-errors" class="anchor-heading" aria-labelledby="message-handling-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Message Handling Errors </h3> <ul> <li>Verify that message roles are one of: “user”, “assistant”, “system”, or “tool”</li> <li>Ensure that tool response messages include the correct tool_call_id</li> </ul> <h3 id="language-model-compatibility"> <a href="#language-model-compatibility" class="anchor-heading" aria-labelledby="language-model-compatibility"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Language Model Compatibility </h3> <ul> <li>Different language models may have varying support for tool calling</li> <li>Check documentation for provider-specific limitations</li> </ul> <h2 id="next-steps"> <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps </h2> <p>After understanding MCP, you might want to explore:</p> <ul> <li>Creating <a href="./agent">agents</a> that leverage MCP for structured communication</li> <li>Implementing custom <a href="./tools">tools</a> that integrate with the MCP format</li> <li>Setting up <a href="./websocket">WebSocket connections</a> for real-time MCP communication</li> <li>Understanding <a href="./memory">memory systems</a> and how they store MCP messages</li> </ul> </main> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2025 Ran Aroussi.<br>Licensed under Creative's Commons Attribution-NonCommercial-NoDerivatives 4.0 (CC BY-NC-ND 4.0) license.</p> </footer> </div> </div> <div class="search-overlay"></div> </div> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
